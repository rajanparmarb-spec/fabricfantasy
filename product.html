<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Product Page</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="product.css">
</head>
<body>

<!-- Header -->
<header style="position: sticky; top: 0; z-index: 999; display: flex; align-items: center; justify-content: space-between; padding: 14px 22px; background: rgba(255, 255, 255, 0.75); backdrop-filter: blur(18px); box-shadow: 0 10px 30px rgba(0,0,0,0.12); border: 1px solid rgba(255,255,255,0.6);">
    <div class="logo" style="font-size: 22px; font-weight: 700; letter-spacing: -0.5px; color: #111;">FabricFantasy</div>
    <nav style="display: flex; gap: 26px; align-items: center;">
        <a href="index.html" style="text-decoration: none; font-size: 14px; font-weight: 500; color: #374151;">Home</a>
        <a href="index.html#shop" style="text-decoration: none; font-size: 14px; font-weight: 500; color: #374151;">Shop</a>
        <a href="cart.html" class="cart" style="position: relative; text-decoration: none; color: #374151;">
            <i class="fa fa-shopping-cart fa-lg"></i>
            <span id="cart-count" style="position: absolute; top: -8px; right: -10px; background: #f4b400; color: #111; font-size: 12px; padding: 2px 6px; border-radius: 50%; font-weight: bold;">0</span>
        </a>
    </nav>
</header>

<section class="product-page">
  <!-- LEFT : IMAGES -->
  <div class="product-images-wrapper">
    <!-- Main Image Display with Zoom -->
    <div class="main-image-container" id="imageZoomContainer">
      <img id="mainProductImage" src="" alt="Product Image">
      <div class="zoom-lens" id="zoomLens"></div>
    </div>
    
    <!-- Zoomed Image Display -->
    <div class="zoom-result" id="zoomResult"></div>
    
    <!-- Thumbnail Gallery Below Main Image -->
    <div class="thumbnail-gallery">
      <!-- Thumbnails will be dynamically loaded here -->
    </div>
  </div>
  
  <!-- RIGHT : DETAILS -->
  <div class="product-details">
    <h1 id="productName"></h1>
    <p id="productPrice"></p>
    <p class="description">
    </p>
    
    <!-- COLOR -->
    <div class="option" id="colorOption" style="display: none;">
      <span>Color:</span>
      <div class="colors" id="productColors">
        <!-- Colors will be dynamically loaded here -->

      </div>
    </div>

    <!-- SIZE -->
    <div class="option">
      <span>Size:</span>
      <div class="sizes">
        <!-- Size buttons will be dynamically loaded here -->
      </div>
    </div>
    
    <button class="add-cart-btn" onclick="addProductToCart()">ADD TO CART</button>
    <p class="size-guide">Size Guide</p>
  </div>
</section>

<script>
  // Load product data
  const product = JSON.parse(localStorage.getItem("selectedProduct"));
  if (product) {
    // Handle both old format (single image) and new format (multiple images)
    const images = product.images || [product.image];
    const thumbnailGallery = document.querySelector(".thumbnail-gallery");
    const mainImage = document.getElementById("mainProductImage");
    
    // Set first image as main
    mainImage.src = images[0];
    mainImage.alt = product.name;
    
    // Clear existing thumbnails
    thumbnailGallery.innerHTML = '';
    
    // Add all thumbnails
    images.forEach((imageUrl, index) => {
      const thumbContainer = document.createElement('div');
      thumbContainer.className = 'thumbnail-item' + (index === 0 ? ' active' : '');
      
      const img = document.createElement('img');
      img.src = imageUrl;
      img.alt = `${product.name} - View ${index + 1}`;
      img.onclick = function() { selectImage(imageUrl, thumbContainer); };
      
      thumbContainer.appendChild(img);
      thumbnailGallery.appendChild(thumbContainer);
    });
    
    // Initialize zoom for first image
    initImageZoom("mainProductImage", "zoomResult");
    
    document.getElementById("productName").innerText = product.name;
    document.getElementById("productPrice").innerText = "₹" + Number(product.price).toLocaleString();
    
    // Update description if available
    const descriptionEl = document.querySelector(".description");
    if (product.description && descriptionEl) {
      descriptionEl.innerText = product.description;
    }
    
    // Generate color options from API data
    const colorsContainer = document.getElementById("productColors");
    const colorOption = document.getElementById("colorOption");
    if (product.colors && colorsContainer) {
      const availableColors = product.colors.split(',').map(c => c.trim());
      colorsContainer.innerHTML = '';
      
      availableColors.forEach((color, index) => {
        const colorSpan = document.createElement('span');
        colorSpan.className = 'color'; // + (index === 0 ? ' active' : '');
        
        // Check if color is hex code or color name
        if (color.startsWith('#')) {
          colorSpan.style.background = color;
        } else {
          colorSpan.style.background = color.toLowerCase();
        }
        
        colorSpan.title = color;
        // colorSpan.onclick = function() { selectProductColor(this); };
        
        colorsContainer.appendChild(colorSpan);
      });
      
      colorOption.style.display = 'block';
    }
    
    // Generate size buttons from API data
    const sizesContainer = document.querySelector(".sizes");
    if (product.sizes && sizesContainer) {
      const availableSizes = product.sizes.split(',').map(s => s.trim());
      sizesContainer.innerHTML = '';
      
      availableSizes.forEach((size, index) => {
        const button = document.createElement('button');
        button.className = 'size-btn';
        button.innerText = size;
        button.onclick = function() { selectProductSize(this); };
        
        // Set middle size as active by default
        if (index === Math.floor(availableSizes.length / 2)) {
          button.classList.add('active');
        }
        
        sizesContainer.appendChild(button);
      });
    }
  }

  // Function to change main image when thumbnail is clicked
  function selectImage(imageUrl, thumbElement) {
    const mainImage = document.getElementById("mainProductImage");
    mainImage.src = imageUrl;
    
    // Remove active class from all thumbnails
    document.querySelectorAll('.thumbnail-item').forEach(thumb => {
      thumb.classList.remove('active');
    });
    
    // Add active class to clicked thumbnail
    thumbElement.classList.add('active');
    
    // Reinitialize zoom for new image
    initImageZoom("mainProductImage", "zoomResult");
  }

  // IMAGE ZOOM FUNCTIONALITY
  function initImageZoom(imgID, resultID) {
    const img = document.getElementById(imgID);
    const result = document.getElementById(resultID);
    const lens = document.getElementById("zoomLens");
    const container = document.getElementById("imageZoomContainer");
    
    if (!img || !result || !lens) return;
    
    // Remove previous event listeners
    container.onmousemove = null;
    container.onmouseleave = null;
    
    const cx = result.offsetWidth / lens.offsetWidth;
    const cy = result.offsetHeight / lens.offsetHeight;
    
    result.style.backgroundImage = `url('${img.src}')`;
    
    // Mouse move event
    container.onmousemove = function(e) {
      e.preventDefault();
      const pos = getCursorPos(e, img);
      let x = pos.x - (lens.offsetWidth / 2);
      let y = pos.y - (lens.offsetHeight / 2);
      
      // Prevent lens from going outside image
      if (x > img.width - lens.offsetWidth) x = img.width - lens.offsetWidth;
      if (x < 0) x = 0;
      if (y > img.height - lens.offsetHeight) y = img.height - lens.offsetHeight;
      if (y < 0) y = 0;
      
      lens.style.left = x + 'px';
      lens.style.top = y + 'px';
      lens.style.display = 'block';
      result.style.display = 'block';
      
      result.style.backgroundPosition = `-${x * cx}px -${y * cy}px`;
    };
    
    // Mouse leave event
    container.onmouseleave = function() {
      lens.style.display = 'none';
      result.style.display = 'none';
    };
    
    function getCursorPos(e, img) {
      const a = img.getBoundingClientRect();
      let x = e.pageX - a.left - window.pageXOffset;
      let y = e.pageY - a.top - window.pageYOffset;
      return {x: x, y: y};
    }
  }

  // Update cart count on page load
  function updateCartCount() {
    let cart = JSON.parse(localStorage.getItem('cart')) || [];
    document.getElementById('cart-count').innerText = cart.length;
  }
  updateCartCount();

  // Color selection function
  window.selectProductColor = function(colorElement) {
    const colorsContainer = colorElement.parentElement;
    colorsContainer.querySelectorAll(".color").forEach(c => c.classList.remove("active"));
    colorElement.classList.add("active");
  }

  // Size selection function
  window.selectProductSize = function(button) {
    const sizesContainer = button.parentElement;
    sizesContainer.querySelectorAll(".size-btn").forEach(s => s.classList.remove("active"));
    button.classList.add("active");
  }

  // Add to cart function
  window.addProductToCart = function() {
    if (!product) {
      alert("Product data not found!");
      return;
    }

    const selectedSize = document.querySelector(".sizes .size-btn.active");
    if (!selectedSize) {
      alert("Please select a size!");
      return;
    }

    const size = selectedSize.innerText;
    const images = product.images || [product.image];
    
    // Get selected color if available
    const selectedColor = document.querySelector("#productColors .color.active");
    const color = selectedColor ? selectedColor.title : '';
    
    let cart = JSON.parse(localStorage.getItem("cart")) || [];
    cart.push({
      name: product.name,
      price: Number(product.price),
      image: images[0], // Use first image for cart
      size: size,
      color: color
    });
    
    localStorage.setItem("cart", JSON.stringify(cart));
    updateCartCount();
    updateFloatingCartCount();

    // Visual feedback
    const button = document.querySelector(".add-cart-btn");
    const originalText = button.innerText;
    button.innerText = "✓ ADDED";
    
    setTimeout(() => {
      button.innerText = originalText;
    }, 1500);
  }

  // Update floating cart count
  function updateFloatingCartCount() {
    const cart = JSON.parse(localStorage.getItem('cart')) || [];
    const badge = document.querySelector('.floating-cart-count');

    if (!badge) return;

    badge.textContent = cart.length;

    if (cart.length === 0) {
      badge.style.display = 'none';
    } else {
      badge.style.display = 'flex';
    }
  }

  // Call on page load
  updateFloatingCartCount();
</script>

<!-- Floating Cart Button -->
<a href="cart.html" class="floating-checkout" aria-label="View Cart">
    <i class="fa fa-shopping-cart"></i>
    <span class="floating-cart-count">0</span>
</a>


</body>
</html>